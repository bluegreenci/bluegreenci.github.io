---
import BlogCard from '@/components/BlogCard.astro'
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { buttonVariants } from '@/components/ui/button'
import { SITE } from '@/consts'
import Layout from '@/layouts/Layout.astro'
import { getAllPosts, groupPostsByYear } from '@/lib/data-utils'
import { Icon } from 'astro-icon/components'

const posts = await getAllPosts()
const postsByYear = groupPostsByYear(posts)
const years = Object.keys(postsByYear).sort((a, b) => parseInt(b) - parseInt(a))
const lastUpdatedLabel = posts[0]?.data.date
  ? posts[0].data.date.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric',
    })
  : '—'

const personSchema = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: SITE.title,
  url: SITE.href,
  description: SITE.description,
}

const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: SITE.title,
  url: SITE.href,
  description: SITE.description,
}

const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: SITE.title,
  url: SITE.href,
  description: SITE.description,
  potentialAction: {
    '@type': 'SearchAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: `${SITE.href}?q={search_term_string}`,
    },
    'query-input': 'required name=search_term_string',
  },
}
---

<Layout class="max-w-5xl pb-24" transition:persist="home-layout">
  <PageHead slot="head" title={`${SITE.title} · Articles`} fullTitle={true} />

  <script type="application/ld+json" set:html={JSON.stringify(personSchema)} />
  <script
    type="application/ld+json"
    set:html={JSON.stringify(organizationSchema)}
  />
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />

  <section class="mt-12">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div>
        <h2 class="text-2xl font-semibold text-slate-900 dark:text-white">
          BlueGreen Chronicles
        </h2>
      </div>
    </div>

    <div class="mt-10 flex flex-col gap-10">
      {
        years.map((year) => (
          <section class="space-y-4">
            <div class="flex items-center gap-3">
              <span class="rounded-full bg-gradient-to-r from-emerald-500/10 via-sky-500/10 to-blue-600/10 px-4 py-1 text-xs font-semibold tracking-[0.35em] text-blue-600 uppercase dark:text-emerald-400">
                {year}
              </span>
              <div class="h-px flex-1 bg-gradient-to-r from-emerald-500/40 via-sky-500/40 to-blue-600/30 dark:from-emerald-500/30 dark:via-sky-500/30 dark:to-blue-600/20" />
            </div>
            <ul class="flex flex-col gap-3">
              {postsByYear[year].map((post) => (
                <li class="group/card rounded-2xl border border-white/40 bg-white/80 p-1 shadow-sm transition hover:-translate-y-0.5 hover:shadow-lg dark:border-white/5 dark:bg-slate-900/60 [background:padding-box,linear-gradient(#fff,#fff),border-box_linear-gradient(135deg,transparent,transparent)] hover:[background:padding-box,linear-gradient(#fff,#fff),border-box_linear-gradient(135deg,rgb(16_185_129),rgb(56_189_248),rgb(37_99_235))] dark:[background:padding-box,linear-gradient(rgb(15_23_42/0.6),rgb(15_23_42/0.6)),border-box_linear-gradient(135deg,transparent,transparent)] dark:hover:[background:padding-box,linear-gradient(rgb(15_23_42/0.6),rgb(15_23_42/0.6)),border-box_linear-gradient(135deg,rgb(16_185_129),rgb(56_189_248),rgb(37_99_235))]">
                  <BlogCard entry={post} />
                </li>
              ))}
              {year === '2025' && (
                <li class="group/card rounded-2xl border border-white/40 bg-white/80 p-1 shadow-sm transition hover:-translate-y-0.5 hover:shadow-lg dark:border-white/5 dark:bg-slate-900/60 [background:padding-box,linear-gradient(#fff,#fff),border-box_linear-gradient(135deg,transparent,transparent)] hover:[background:padding-box,linear-gradient(#fff,#fff),border-box_linear-gradient(135deg,rgb(16_185_129),rgb(56_189_248),rgb(37_99_235))] dark:[background:padding-box,linear-gradient(rgb(15_23_42/0.6),rgb(15_23_42/0.6)),border-box_linear-gradient(135deg,transparent,transparent)] dark:hover:[background:padding-box,linear-gradient(rgb(15_23_42/0.6),rgb(15_23_42/0.6)),border-box_linear-gradient(135deg,rgb(16_185_129),rgb(56_189_248),rgb(37_99_235))]">
                  <a
                    href="https://aziflaj.github.io/tags/runbook-notes/"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="group flex h-full flex-col gap-4 rounded-[18px] px-5 py-4 text-left transition-all duration-300 hover:translate-x-0.5"
                  >
                    <div class="flex flex-col gap-3">
                      <div class="flex items-center gap-2 text-[11px] font-semibold uppercase tracking-[0.35em] text-slate-500/80 dark:text-slate-400/80">
                        <span>Previous Dev Notes</span>
                        <span class="h-px flex-1 rounded-full bg-gradient-to-r from-emerald-500/40 via-sky-500/40 to-blue-600/40 dark:from-emerald-500/30 dark:via-sky-500/30 dark:to-blue-600/30" aria-hidden="true"></span>
                      </div>
                      <div class="flex items-start justify-between gap-4">
                        <div class="space-y-2">
                          <h3 class="text-lg font-semibold leading-snug text-slate-900 transition-colors group-hover:text-blue-600 dark:text-white dark:group-hover:text-emerald-400">
                            Development Notes Archive
                          </h3>
                          <p class="text-sm text-slate-600 dark:text-slate-300 line-clamp-2">
                            Access the previous development notes and technical documentation from earlier iterations.
                          </p>
                        </div>
                        <span class="inline-flex size-10 flex-shrink-0 items-center justify-center rounded-full border border-white/60 bg-white/80 text-blue-600 shadow-sm transition-all duration-300 group-hover:-translate-y-0.5 group-hover:text-emerald-500 dark:border-white/10 dark:bg-white/10 dark:text-emerald-400">
                          <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                          </svg>
                        </span>
                      </div>
                    </div>
                    <div class="flex flex-wrap items-center gap-2 text-xs text-slate-500 dark:text-slate-300">
                      <span class="inline-flex items-center gap-1 rounded-full bg-blue-50/80 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-blue-600 dark:bg-white/10 dark:text-sky-400">
                        <svg class="size-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                        Archive
                      </span>
                    </div>
                  </a>
                </li>
              )}
            </ul>
          </section>
        ))
      }
    </div>
  </section>
</Layout>
