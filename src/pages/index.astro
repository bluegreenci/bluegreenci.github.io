---
import BlogCard from '@/components/BlogCard.astro'
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { buttonVariants } from '@/components/ui/button'
import { SITE } from '@/consts'
import Layout from '@/layouts/Layout.astro'
import { getAllPosts, groupPostsByYear } from '@/lib/data-utils'
import { Icon } from 'astro-icon/components'

const posts = await getAllPosts()
const postsByYear = groupPostsByYear(posts)
const years = Object.keys(postsByYear).sort((a, b) => parseInt(b) - parseInt(a))
const lastUpdatedLabel = posts[0]?.data.date
  ? posts[0].data.date.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric',
    })
  : '—'

const personSchema = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: SITE.title,
  url: SITE.href,
  description: SITE.description,
}

const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: SITE.title,
  url: SITE.href,
  description: SITE.description,
}

const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: SITE.title,
  url: SITE.href,
  description: SITE.description,
  potentialAction: {
    '@type': 'SearchAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: `${SITE.href}?q={search_term_string}`,
    },
    'query-input': 'required name=search_term_string',
  },
}
---

<Layout class="max-w-5xl pb-24" transition:persist="home-layout">
  <PageHead slot="head" title={`${SITE.title} · Articles`} fullTitle={true} />

  <script type="application/ld+json" set:html={JSON.stringify(personSchema)} />
  <script
    type="application/ld+json"
    set:html={JSON.stringify(organizationSchema)}
  />
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />

  <section class="mt-12">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div>
        <h2 class="text-2xl font-semibold text-slate-900 dark:text-white">
          BlueGreen Chronicles
        </h2>
      </div>
    </div>

    <div class="mt-10 flex flex-col gap-10">
      {
        years.map((year) => (
          <section class="space-y-4">
            <div class="flex items-center gap-3">
              <span class="rounded-full bg-gradient-to-r from-emerald-500/10 via-sky-500/10 to-blue-600/10 px-4 py-1 text-xs font-semibold tracking-[0.35em] text-blue-600 uppercase dark:text-emerald-400">
                {year}
              </span>
              <div class="h-px flex-1 bg-gradient-to-r from-emerald-500/40 via-sky-500/40 to-blue-600/30 dark:from-emerald-500/30 dark:via-sky-500/30 dark:to-blue-600/20" />
            </div>
            <ul class="flex flex-col gap-3">
              {postsByYear[year].map((post) => (
                <li class="group/card rounded-2xl border border-white/40 bg-white/80 p-1 shadow-sm transition hover:-translate-y-0.5 hover:shadow-lg dark:border-white/5 dark:bg-slate-900/60 [background:padding-box,linear-gradient(#fff,#fff),border-box_linear-gradient(135deg,transparent,transparent)] hover:[background:padding-box,linear-gradient(#fff,#fff),border-box_linear-gradient(135deg,rgb(16_185_129),rgb(56_189_248),rgb(37_99_235))] dark:[background:padding-box,linear-gradient(rgb(15_23_42/0.6),rgb(15_23_42/0.6)),border-box_linear-gradient(135deg,transparent,transparent)] dark:hover:[background:padding-box,linear-gradient(rgb(15_23_42/0.6),rgb(15_23_42/0.6)),border-box_linear-gradient(135deg,rgb(16_185_129),rgb(56_189_248),rgb(37_99_235))]">
                  <BlogCard entry={post} />
                </li>
              ))}
            </ul>
          </section>
        ))
      }
    </div>
  </section>
</Layout>
